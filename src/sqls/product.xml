<!DOCTYPE mapper
  PUBLIC "-//www.mybatis.org//DTD Mapper 3.0//EN"
  "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Product">

<!-- 상품리스트(검색 - 관리자) -->
<select id="prdSearchList" parameterType="cd.com.a.model.ProductParam" resultType="cd.com.a.model.productDto">
	SELECT @rownum:=@rownum+1 as rownum, product_num, product_code, product_img, product_name, 
		product_price, product_brand, product_hidden, product_group, product_sub_group,
		product_sale, product_stock, product_regi_date, product_del 
	FROM product
	WHERE (@rownum:=0)=0
	<where>
		<if test="s_category != null and s_category != '' 
			  and s_keyword != null and s_keyword != ''
			  and s_product_group != null and s_product_group != ''
			  and s_product_sub_group != null and s_product_sub_group != ''">
				AND s_product_group = #{product_group} 
			 	AND s_product_sub_group = #{product_sub_group}
			 	AND soldStateArr = #{product_stock}
			 	
			<if test="s_category == 'product_name'">
				AND product_name LIKE CONCAT ('%',#{s_keyword},'%')
			</if>
			<if test="s_category == 'product_code'">
				AND product_code LIKE CONCAT ('%',#{s_keyword},'%')
			</if>
			<if test="s_category == 'product_brand'">
				AND product_brand LIKE CONCAT ('%',#{s_keyword},'%')
			</if>
			<if test="product_group_df == 1 and product_group_df == 2 and product_group_df == 3">
				AND product_group_df = #{product_group}
			</if>
			<if test="product_sub_group_df == 1 and product_sub_group_df == 2 and product_sub_group_df == 3
			and product_sub_group_df == 4 and product_sub_group_df == 5">
				AND product_group_df = #{product_group}
			</if>
			
			<if test="soldStateArr == 1">
				AND product_stock = LIKE CONCAT ('%',#{s_soldState},'%')
			</if>
			<if test="soldStateArr == 2">
				AND NOT product_stock LIKE CONCAT ('%',#{s_soldState},'%') 
			</if>
		</if>
	</where>
	
	<!-- WHERE RNUM BETWEEN ${start} AND ${end} -->
	ORDER BY product_num
	LIMIT #{start}, #{recordCountPerPage}
		   
</select>

<select id="getPrdCount" resultType="java.lang.Integer">
SELECT IFNULL(COUNT(*), 0) FROM product;
</select>

<!-- 상품리스트(페이징 - 관리자) -->
<!-- 
<select id="getPrdCount" parameterType="cd.com.a.model.ProductParam" resultType="java.lang.Integer">
SELECT NVL(COUNT(*), 0) AS CNT
FROM product

<where>
	<if test="s_category != null and s_category != ''
		and s_keyword != null and s_keyword != ''">
		<if test="s_category == 'title'">
			AND TITLE LIKE '%'||#{s_keyword}||'%'
		</if>
		<if test="s_category == 'contents'">
			AND CONTENT LIKE '%'||#{s_keyword}||'%'
		</if>
		<if test="s_category == 'writer'">
			AND ID=#{s_keyword}
		</if>				
	</if>
</where>

</select> 
-->


<!-- 상품등록(관리자) -->
<insert id="productInsert" parameterType="cd.com.a.model.productDto">
	INSERT INTO product(
			product_name, product_readcount, product_img, product_price,
			product_group, product_sub_group, product_code, product_content, product_regi_date,
			product_brand, product_sale, product_hidden, product_stock, product_delivery_auth
		)

	VALUES(
			#{product_name}, 0, #{product_img}, #{product_price}, 
			#{product_group}, #{product_sub_group}, #{product_code}, #{product_content}, CURRENT_TIMESTAMP(),
			#{product_brand}, #{product_sale}, #{product_hidden}, #{product_stock}, #{product_delivery_auth}
		)
</insert>


<!-- 상품수정(관리자) -->
<update id="prdUpdate" parameterType="cd.com.a.model.productDto">
	UPDATE product SET
			product_name=#{product_name}, product_img=#{product_img}, product_price=#{product_price}, 
			product_group=#{product_group}, product_sub_group=#{product_sub_group}, product_code=#{product_code}, 
			product_content=#{product_content}, product_regi_date=CURRENT_TIMESTAMP(),
			product_brand=#{product_brand}, product_sale=#{product_sale}, product_hidden=#{product_hidden}, 
			product_stock=#{product_stock}, product_delivery_auth=#{product_delivery_auth}
	WHERE 	product_num=#{product_num}
</update>


<!-- 상품리스트 삭제(관리자) -->
<update id="prdDelete" parameterType="java.util.ArrayList">
	UPDATE product
	SET product_del=1, product_sale=1
	WHERE product_num IN(
		<foreach collection="array" item="product_num" separator=",">
		#{product_num}
		</foreach>
	)
</update>



<!-- ========= 상품리스트(client)  ======== -->
<select id="getPrdList" resultType="cd.com.a.model.productDto">
	SELECT 
	product_num, product_code, product_img, product_name, product_price, 
		   product_brand, product_hidden, product_sale, product_stock, 
		   product_regi_date, product_del
	FROM product
</select>

<!-- ========= 상품구매(client & 관리자) 상품상세 ======== -->
<select id="getPrd" parameterType="java.lang.Integer" resultType="cd.com.a.model.productDto">
	SELECT 
		   product_num, product_code, product_img, product_name, product_price, product_delivery_auth, 
		   product_brand, product_hidden, product_sale, product_stock, product_content,
		   product_group, product_sub_group,
		   product_regi_date, product_del
	FROM product
	WHERE product_num = #{product_num}
</select>


<!-- ========= 상품구매(client) 상품상세 (옵션상품들) ======== --> 
<select id="getOptionProduct" parameterType="java.lang.String" resultType="cd.com.a.model.productDto">
	select * from product 
	where product_name like concat(#{product_name},'%')
</select>

</mapper>